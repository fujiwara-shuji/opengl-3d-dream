# 3D モデルエディタ

学習目的でゼロから構築した、ソフトウェアレイトレーシングを用いた軽量3Dモデルエディタ。GPU アクセラレーションに頼らず、CPU ベースの独自レンダリングパイプラインを実装しています。

## 機能

### レンダリング
- **ソフトウェアレイトレーシング**: CPU ベースのレイトレーシング実装（反射あり）
- **ランバート拡散反射**: 光源方向に基づく現実的な表面シェーディング
- **鏡面反射**: 表面ごとに調整可能な反射強度
- **太陽と空のレンダリング**: カスタマイズ可能な太陽位置と空のグラデーション
- **座標軸表示**: 適切な遮蔽処理を伴う3D座標系の可視化

### モデリング
- **独自ファイル形式 (.fjwr)**: シンプルなテキストベースの3Dモデル形式
- **頂点・辺・面のサポート**: 完全なジオメトリ表現
- **インタラクティブな頂点選択**: 可視性チェック付きのクリック選択
- **頂点操作**: 選択した頂点を3D空間で移動（Gキー）

### ユーザーインターフェース
- **Dear ImGui 統合**: すべての設定を直感的に操作できるUIパネル
- **リアルタイム表示制御**: 頂点・辺・面・座標軸の表示切り替え
- **反射設定**: 反射強度と深度の調整
- **ランバート拡散反射制御**: 環境光と拡散光の設定
- **太陽と空の設定**: 太陽の色・サイズ・位置、空のグラデーションをカスタマイズ

### カメラシステム
- **軌道カメラ**: 中クリック+ドラッグで注視点を中心に回転
- **ズーム**: マウスホイールで距離調整
- **プリセット視点**: 数字キー（1=正面、3=右側面、7=上面）で素早く視点変更
- **選択へのフォーカス**: Fキーで選択頂点にカメラを中心合わせ

## 技術仕様

### アーキテクチャ
- **言語**: C++17
- **プラットフォーム**: Linux/WSL (Windows Subsystem for Linux)
- **座標系**: 左手系、Z軸上向き（X軸=右、Y軸=手前、Z軸=上）
- **面の向き**: 反時計回り（CCW）= 表面

### 依存関係
- **GLFW**: ウィンドウ作成と入力処理
- **Dear ImGui**: ユーザーインターフェース
- **OpenGL 2.1**: 最終フレームバッファ表示のみ（レンダリング自体はソフトウェアベース）

### ライブラリ
- カスタム数学ライブラリ（Vector3、Matrix4）
- カスタムレイトレーシングエンジン
- カスタムモデル I/O システム

## ビルド方法

### 必要なパッケージ
```bash
# Ubuntu/Debian
sudo apt-get install build-essential libglfw3-dev libgl1-mesa-dev

# Arch Linux
sudo pacman -S base-devel glfw-x11 mesa
```

### コンパイル
```bash
# リポジトリをクローン
git clone https://github.com/<your-username>/opengl-3d-dream.git
cd opengl-3d-dream

# Dear ImGui をセットアップ（初回のみ）
mkdir -p external && cd external
git clone --depth 1 https://github.com/ocornut/imgui.git
cd ..

# メインアプリケーションをコンパイル
./compile.sh

# その他のコマンド
./compile.sh model-editor    # メインアプリケーション（明示的）
./compile.sh clean            # ビルドディレクトリをクリーン
./compile.sh help             # ヘルプを表示
```

### 実行
```bash
./build/model-editor
```

## 使い方

### マウス操作
- **左クリック**: 頂点を選択
- **中クリック + ドラッグ**: カメラを注視点中心に回転
- **マウスホイール**: ズームイン/アウト

### キーボードショートカット
- **G**: 頂点移動モード開始（頂点選択後）
- **Escape**: 頂点移動をキャンセル / 選択解除
- **F**: 選択頂点にカメラをフォーカス
- **1**: 正面視点
- **3**: 右側面視点
- **7**: 上面視点
- **A**: 座標軸の表示切り替え
- **+/-**: 座標軸の長さを増減

### ファイル操作
- **Ctrl+N**: 新規作成
- **Ctrl+O**: .fjwr ファイルを開く
- **Ctrl+S**: 上書き保存
- **Ctrl+Shift+S**: 名前を付けて保存

## ファイル形式 (.fjwr)

シンプルなテキストベース形式：

```
# コメント
v 0.0 0.0 0.0    # 頂点 (x y z)
v 1.0 0.0 0.0
v 1.0 1.0 0.0
f 0 1 2          # 面（頂点インデックス）
l 0 1            # 辺（頂点インデックス）
```

## プロジェクト構造

```
opengl-3d-dream/
├── src/
│   ├── Main.cpp                    # アプリケーションエントリーポイント
│   ├── math/                       # Vector3, Matrix4
│   ├── core/                       # Model, Camera, Ray, CoordinateAxes
│   ├── rendering/                  # SoftwareRenderer, レイトレーシング
│   ├── input/                      # InputHandler
│   ├── ui/                         # UI (Dear ImGui)
│   └── utils/                      # ユーティリティ、エラー処理
├── external/
│   └── imgui/                      # Dear ImGui ソースコード
├── compile.sh                      # ビルドスクリプト
├── default_scene.fjwr              # デモオブジェクト付きのデフォルトシーン
└── CLAUDE.md                       # 詳細な設計仕様書
```

## 設計思想

このプロジェクトは、以下を理解するための学習目的で構築されました：
- GPU 抽象化なしでの3Dグラフィックスの基礎
- レイトレーシングアルゴリズムと交差判定
- カメラ投影と座標変換
- 3Dツール向けのユーザーインターフェース設計
- インタラクティブアプリケーションのソフトウェアアーキテクチャ

レンダリングは意図的にCPUベースとし、パフォーマンスよりもアルゴリズムの透明性と教育的価値を優先しています。

## スクリーンショット

*(スクリーンショットを撮影後に追加予定)*

## 今後の予定

- [ ] アンドゥ/リドゥシステム
- [ ] 複数オブジェクトのサポート
- [ ] テクスチャマッピング
- [ ] 高度なシェーディングモデル（Phong、Blinn-Phong）
- [ ] 空間分割による高速化（BVH、Octree）
- [ ] OBJ ファイル形式のサポート
- [ ] 頂点・辺・面の作成と削除

## 謝辞

- Claude (Anthropic) のガイダンスにより構築
- Dear ImGui by Omar Cornut
- GLFW by Camilla Löwy and contributors
